{"version":3,"sources":["uploader.coffee"],"names":[],"mappings":"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","file":"uploader.js","sourcesContent":["class LibraryUploader\n    constructor: (@$element, options) ->\n        @__attachEvent()\n        @__init()\n\n    __attachEvent: () ->\n        $ document \n            .on 'drop dragover', (e)->\n                e.preventDefault()\n                return\n\n        $ document\n            .on 'dragleave drop', (e)->\n                $ '.uploader-dropzone', @$element\n                    .removeClass 'hover'\n\n        $ document\n            .on 'dragover', (e)->\n                dropzone = $ '.uploader-dropzone', @$element\n                timeout = window.dropZoneTimeout\n\n                if (!timeout)\n                    dropzone.addClass('in')\n                else\n                    clearTimeout(timeout)\n\n                found = false\n                node = e.target\n\n                if $(node).hasClass('uploader-dropzone')\n                    if !$(node).hasClass('hover')\n                        $(node).addClass 'hover'\n\n                else if $(node).parents('.uploader-dropzone').length > 0\n                    if !$(node).parents('.uploader-dropzone').hasClass('hover')\n                        $(node).parents('.uploader-dropzone').addClass('hover')\n                else\n                    dropzone.removeClass 'hover'\n\n                window.dropZoneTimeout = setTimeout ()->\n                    window.dropZoneTimeout = null\n\n                    return\n                , 100\n\n                return\n\n    __init: () ->\n        target = '/admin/inoplate-media/libraries/upload'\n        chunkSize = @$element.data('chunk')\n        maxUploadSize = @$element.data('maxupload')\n        browseId = $ \".btn-browse\", @$element\n        dropzoneId = $ \".uploader-dropzone\", @$element\n        fileContainerId = $ \".file-container\", @$element\n\n        ###\n            The simulaneous upload set to 1\n            Its because Laravel framework on server side has mysterious session persistence problem\n        ###\n\n        uploader = new Flow\n            target: target\n            forceChunkSize: true\n            chunkSize: chunkSize\n            simultaneousUploads: 1\n            headers:\n                'X-Requested-With' : 'XMLHttpRequest'\n                'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n\n\n        uploader.assignBrowse(browseId[0])\n        uploader.assignDrop(dropzoneId[0])\n\n        uploader.on 'fileAdded', (file) =>\n            if file.size > maxUploadSize\n                return false\n\n            @$element.trigger 'uploader.fileAdded', [file]\n\n            return\n\n        uploader.on 'fileProgress', (file) =>\n            @$element.trigger 'uploader.fileProgress', [file]\n\n            return\n\n        uploader.on 'filesSubmitted', (file, event) =>\n            uploader.upload()\n\n            @$element.trigger 'uploader.filesSubmitted', [file, event]\n\n            return\n\n        uploader.on 'fileSuccess', (file, message) =>\n            @$element.trigger 'uploader.fileSuccess', [file, message]\n\n            return\n\n        uploader.on 'fileRetry', (file, chunk) =>\n            @$element.trigger 'uploader.fileRetry', [file, chunk]\n\n            return\n\n        uploader.on 'fileError', (file, message, chunk) =>\n            @$element.trigger 'uploader.fileError', [file, message, chunk]\n\n            return\n\n# PLUGIN DEFINITION\n# ============================\n\n$.fn.libraryUploader = (option) ->\n    args = arguments\n    defaults = {}\n\n    this.each () ->\n        $this = $ this\n        data = $this.data('library.uploader')\n        options = $.extend {}, defaults, $this.data(), typeof option == 'object' && option\n        if !data \n            $this.data 'library.uploader', (data = new LibraryUploader $this, options)\n\n        if typeof option == 'string'\n            argsToSent = []\n\n            for k,v of args\n                if k > 0\n                    argsToSent.push v\n\n            data[option].apply(data, argsToSent)\n\n    this\n\n# INIT PLUGIN TO DOM\n# ===========================\n\n$ ->\n    $ '.uploader'\n        .libraryUploader()"],"sourceRoot":"/source/"}